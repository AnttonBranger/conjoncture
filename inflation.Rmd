---
title: "Prix, couts et déséquilibres"
author: "Antton Branger"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
rm(list = ls())
```

Chargement des packages
```{r}
library(tidyverse)
library(eurostat)
library(lubridate)
library(janitor)
library(ggthemes)
library(mFilter)
```

# Inflation 

Importation des données 

Infaltion totale
```{r}
hicp <- get_eurostat("prc_hicp_manr", time_format = "date") 
hicp_total <- hicp %>%
  filter(
    geo == "PT",
    coicop == "CP00",   # indice global
    unit == "RCH_A"     # taux annuel %
  ) %>%
  filter(TIME_PERIOD >= as.Date("2023-01-01"))
```

Inflation sous-jacente
```{r}
hicp_core <- hicp %>%
  filter(
    geo == "PT",
    coicop == "TOT_X_NRG_FOOD",  # inflation sous-jacente
    unit == "RCH_A"
  ) %>%
  filter(TIME_PERIOD >= as.Date("2023-01-01"))
```

Décomposition de l'inflation
```{r}
hicp_components <- hicp %>%
  filter(
    geo == "PT",
    coicop %in% c(
      "CP011", # alimentation hors alcool
      "CP021", # alcool et tabac
      "CP03",  # habillement, chaussures
      "CP04",  # logement, énergie
      "CP05",  # ameublement
      "CP06",  # santé
      "CP07",  # transports (incl. carburants)
      "CP08",  # communications
      "CP09",  # loisirs
      "CP10",  # éducation
      "CP11",  # restauration / hôtellerie
      "CP12"   # autres services
    ),
    unit == "RCH_A"
  ) %>%
  filter(TIME_PERIOD >= as.Date("2023-01-01"))
```


Graphique comparaison inflation totale et sous-jacente
```{r}
df_infl <- bind_rows(
  hicp_total %>% mutate(type = "Inflation totale"),
  hicp_core %>% mutate(type = "Inflation sous-jacente")
) %>% 
  filter(TIME_PERIOD >= as.Date("2024-01-01"))

ggplot(df_infl, aes(TIME_PERIOD, values, color = type)) +
  geom_line(size = 1.2) +
  labs(
    title = "Portugal – Inflation totale et sous-jacente",
    subtitle = "Taux annuels (%)",
    x = "Date",
    y = "%",
    color = "",
    caption = "Source : Eurostat (prc_hicp_manr)"
  ) +
  theme_minimal(base_size = 13)

```

Tableau comparaison inflation totale et sous-jacente
```{r}
table_infl <- df_infl %>%
  arrange(type, TIME_PERIOD) %>%
  group_by(type) %>%
  mutate(variation_yoy = values) %>%   # déjà en YoY dans Eurostat
  select(TIME_PERIOD, type, variation_yoy)

table_infl
write.csv2(table_infl, "inflation.csv", 
           row.names = FALSE, fileEncoding = "UTF-8")
```


Graphique de la décomposition de l'inflation
```{r}
ggplot(hicp_comp_grouped, aes(TIME_PERIOD, values, color = groupe)) +
  geom_line(size = 1.2) +
  labs(
    title = "Portugal – Décomposition de l'inflation",
    subtitle = "Taux annuels (%)",
    x = "Date",
    y = "%",
    color = "Composante",
    caption = "Source : Eurostat (prc_hicp_manr)"
  ) +
  theme_minimal(base_size = 13)

```



